aptitude install debconf-utils
debconf-set-selections <(echo "slrnpull        slrnpull/run_from       select  manually")
aptitude install slrnpull mutt
rm /etc/cron.daily/slrnpull


======== TEST ==========
cat >/etc/news/slrnpull.conf <<EOF
default 0 0 0
gmane.mail.imap.offlineimap.general 0 0 0
gwene.org.offlineimap.news 0 0 0
gmane.mail.help 0 0 0
EOF

echo "news.gmane.org" >>/etc/news/server

mkdir /root/test-nntp/
slrnpull -d /root/test-nntp/ -h news.gmane.org --no-post

# http://wiki.thorx.net/wiki/MailNews

Maildir: new, cur, tmp -> new should be symlink to nntp subdir, others should be empty

while read x ; do
	echo "$x"
done </etc/news/slrnpull.conf

Mutt:
set mbox_type=Maildir
set folder=/root/test-maildir
set mbox=+
unmailboxes *
mailboxes ! =gmane-offlineimap
macro index M "T.*\n;WN" "Mark all messages as read"

start Mutt, 'c' '?' choose folder, 'M', 'q'
-> Mutt has copied all messages to 'cur' directory

mutt -f /root/test-maildir/gmane-offlineimap/ -Z
======== END TEST ==========

python fetch-testmail.py
aptitude install dovecot-imapd

# http://wiki.ubuntuusers.de/Dovecot
# http://wiki2.dovecot.org/QuickConfiguration
# http://wiki.dovecot.org/UserDatabase/Static

cd /
patch -p0 <<EOF
diff -ru0 /etc/dovecot.bak/conf.d/10-auth.conf /etc/dovecot/conf.d/10-auth.conf
--- /etc/dovecot.bak/conf.d/10-auth.conf        2013-02-05 02:03:27.000000000 +0100
+++ /etc/dovecot/conf.d/10-auth.conf    2013-04-07 14:50:09.868211207 +0200
@@ -121 +121 @@
-!include auth-system.conf.ext
+#!include auth-system.conf.ext
@@ -127 +127 @@
-#!include auth-static.conf.ext
+!include auth-static.conf.ext
diff -ru0 /etc/dovecot.bak/conf.d/10-mail.conf /etc/dovecot/conf.d/10-mail.conf
--- /etc/dovecot.bak/conf.d/10-mail.conf        2013-02-05 02:03:27.000000000 +0100
+++ /etc/dovecot/conf.d/10-mail.conf    2013-04-07 17:45:34.136248511 +0200
@@ -30 +30 @@
-mail_location = mbox:~/mail:INBOX=/var/mail/%u
+mail_location = maildir:/var/mail/%u
@@ -143 +143 @@
-#mail_fsync = optimized
+mail_fsync = never
diff -ru0 /etc/dovecot.bak/conf.d/auth-static.conf.ext /etc/dovecot/conf.d/auth-static.conf.ext
--- /etc/dovecot.bak/conf.d/auth-static.conf.ext        2013-02-05 02:03:27.000000000 +0100
+++ /etc/dovecot/conf.d/auth-static.conf.ext    2013-04-07 15:44:12.184252277 +0200
@@ -16,4 +16,4 @@
-#passdb {
-#  driver = static
-#  args = password=test
-#}
+passdb {
+  driver = static
+  args = password=test
+}
@@ -21,4 +21,4 @@
-#userdb {
-#  driver = static
-#  args = uid=vmail gid=vmail home=/home/%u
-#}
+userdb {
+  driver = static
+  args = uid=vmail gid=mail home=/var/mail/%u
+}
EOF

adduser --system --ingroup mail --no-create-home --disabled-login --uid 900 vmail

/etc/init.d/dovecot restart

# error log is in /var/log/mail.err

socat STDIO OPENSSL:localhost:993,verify=0
a01 login smith test
CTRL+D

# => now we can use arbitrary users on localhost with password 'test'

python offlineimap.py -c /root/converted-nntp-to-testmail-imap.conf
