aptitude install debconf-utils
debconf-set-selections <(echo "slrnpull        slrnpull/run_from       select  manually")
aptitude install slrnpull mutt
rm /etc/cron.daily/slrnpull

cd /path/to/offlineimap-git
python test2/fetch-testmail.py


aptitude install dovecot-imapd

# http://wiki.ubuntuusers.de/Dovecot
# http://wiki2.dovecot.org/QuickConfiguration
# http://wiki.dovecot.org/UserDatabase/Static

cd /
patch -p0 <<EOF
diff -ru0 /etc/dovecot.bak/conf.d/10-auth.conf /etc/dovecot/conf.d/10-auth.conf
--- /etc/dovecot.bak/conf.d/10-auth.conf        2013-02-05 02:03:27.000000000 +0100
+++ /etc/dovecot/conf.d/10-auth.conf    2013-04-07 14:50:09.868211207 +0200
@@ -121 +121 @@
-!include auth-system.conf.ext
+#!include auth-system.conf.ext
@@ -127 +127 @@
-#!include auth-static.conf.ext
+!include auth-static.conf.ext
diff -ru0 /etc/dovecot.bak/conf.d/10-mail.conf /etc/dovecot/conf.d/10-mail.conf
--- /etc/dovecot.bak/conf.d/10-mail.conf        2013-02-05 02:03:27.000000000 +0100
+++ /etc/dovecot/conf.d/10-mail.conf    2013-04-07 17:45:34.136248511 +0200
@@ -30 +30 @@
-mail_location = mbox:~/mail:INBOX=/var/mail/%u
+mail_location = maildir:/var/mail/%u
@@ -143 +143 @@
-#mail_fsync = optimized
+mail_fsync = never
diff -ru0 /etc/dovecot.bak/conf.d/auth-static.conf.ext /etc/dovecot/conf.d/auth-static.conf.ext
--- /etc/dovecot.bak/conf.d/auth-static.conf.ext        2013-02-05 02:03:27.000000000 +0100
+++ /etc/dovecot/conf.d/auth-static.conf.ext    2013-04-07 15:44:12.184252277 +0200
@@ -16,4 +16,4 @@
-#passdb {
-#  driver = static
-#  args = password=test
-#}
+passdb {
+  driver = static
+  args = password=test
+}
@@ -21,4 +21,4 @@
-#userdb {
-#  driver = static
-#  args = uid=vmail gid=vmail home=/home/%u
-#}
+userdb {
+  driver = static
+  args = uid=vmail gid=mail home=/var/mail/%u
+}
EOF

adduser --system --ingroup mail --no-create-home --disabled-login --uid 900 vmail

/etc/init.d/dovecot restart

# error log is in /var/log/mail.err

socat STDIO OPENSSL:localhost:993,verify=0
a01 login smith test
CTRL+D

# => now we can use arbitrary users on localhost with password 'test'

# push those mails to a testmail account
python offlineimap.py -c test/testmail-to-dovecot.conf

# add additional test mails
# -> too much work ;-)


==== DON'T DO ====
aptitude install couchdb gnome-keyring libpam-gnome-keyring
gnome-keyring-daemon
/usr/lib/desktopcouch/desktopcouch-get-port
-> gnome-keyring doesn't work without a display and desktopcouch needs it
  http://superuser.com/questions/141036/use-of-gnome-keyring-daemon-without-x
  https://bbs.archlinux.org/viewtopic.php?id=135448
==== END DON'T DO ====
